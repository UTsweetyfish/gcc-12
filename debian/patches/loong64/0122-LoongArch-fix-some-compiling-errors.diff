From 008f5441a51ddbff6f8af533023d4f99ed0de97c Mon Sep 17 00:00:00 2001
From: Peng Fan <fanpeng@loongson.cn>
Date: Tue, 11 Jun 2024 01:55:09 +0000
Subject: [PATCH 122/133] LoongArch: fix some compiling errors

Signed-off-by: Peng Fan <fanpeng@loongson.cn>
---
 gcc/config/loongarch/loongarch-builtins.cc    |  5 --
 gcc/config/loongarch/loongarch-c.cc           | 11 ---
 gcc/config/loongarch/loongarch.cc             |  4 +
 .../gcc.target/loongarch/math-float-128.c     | 81 -------------------
 4 files changed, 4 insertions(+), 97 deletions(-)
 delete mode 100644 gcc/testsuite/gcc.target/loongarch/math-float-128.c

diff --git a/gcc/config/loongarch/loongarch-builtins.cc b/gcc/config/loongarch/loongarch-builtins.cc
index a4a7dbec91e..2d9743d8619 100644
--- a/src/gcc/config/loongarch/loongarch-builtins.cc
+++ b/src/gcc/config/loongarch/loongarch-builtins.cc
@@ -2440,11 +2440,6 @@ loongarch_init_builtins (void)
   unsigned int i;
   tree type;
 
-  /* Register the type float128_type_node as a built-in type and
-     give it an alias "__float128".  */
-  (*lang_hooks.types.register_builtin_type) (float128_type_node,
-					    "__float128");
-
   /* Iterate through all of the bdesc arrays, initializing all of the
      builtin functions.  */
   for (i = 0; i < ARRAY_SIZE (loongarch_builtins); i++)
diff --git a/gcc/config/loongarch/loongarch-c.cc b/gcc/config/loongarch/loongarch-c.cc
index 2cf84eec708..ff6545c5d48 100644
--- a/src/gcc/config/loongarch/loongarch-c.cc
+++ b/src/gcc/config/loongarch/loongarch-c.cc
@@ -114,17 +114,6 @@ loongarch_cpu_cpp_builtins (cpp_reader *pfile)
       builtin_define ("__loongarch_simd_width=256");
     }
 
-  /* Add support for FLOAT128_TYPE on the LoongArch architecture.  */
-  builtin_define ("__FLOAT128_TYPE__");
-
-  /* Map the old _Float128 'q' builtins into the new 'f128' builtins.  */
-  builtin_define ("__builtin_fabsq=__builtin_fabsf128");
-  builtin_define ("__builtin_copysignq=__builtin_copysignf128");
-  builtin_define ("__builtin_nanq=__builtin_nanf128");
-  builtin_define ("__builtin_nansq=__builtin_nansf128");
-  builtin_define ("__builtin_infq=__builtin_inff128");
-  builtin_define ("__builtin_huge_valq=__builtin_huge_valf128");
-
   /* Native Data Sizes.  */
   builtin_define_with_int_value ("_LOONGARCH_SZINT", INT_TYPE_SIZE);
   builtin_define_with_int_value ("_LOONGARCH_SZLONG", LONG_TYPE_SIZE);
diff --git a/gcc/config/loongarch/loongarch.cc b/gcc/config/loongarch/loongarch.cc
index 08a310f47eb..73d3651f33e 100644
--- a/src/gcc/config/loongarch/loongarch.cc
+++ b/src/gcc/config/loongarch/loongarch.cc
@@ -8207,7 +8207,9 @@ merge_two:
   if (target != operands[0])
     emit_move_insn (operands[0],
            gen_lowpart (GET_MODE (operands[0]), target));
+    }
 }
+
 void
 loongarch_expand_vec_perm (rtx target, rtx op0, rtx op1, rtx sel)
 {
@@ -10574,7 +10576,9 @@ loongarch_expand_vector_init (rtx target, rtx vals)
  
   /* Loongson is the only cpu with vectors with more elements.  */
   gcc_assert (0);
+    }
 }
+
 /* Implement HARD_REGNO_CALLER_SAVE_MODE.  */
 
 machine_mode
diff --git a/gcc/testsuite/gcc.target/loongarch/math-float-128.c b/gcc/testsuite/gcc.target/loongarch/math-float-128.c
deleted file mode 100644
index 387566a57c9..00000000000
--- a/src/gcc/testsuite/gcc.target/loongarch/math-float-128.c
+++ /dev/null
@@ -1,81 +0,0 @@
-/* { dg-do compile } */
-/* { dg-options " -march=loongarch64 -O2 " } */
-/* { dg-final { scan-assembler-not "my_fabsq2:.*\\bl\t%plt\\(__builtin_fabsq\\).*my_fabsq2" } } */
-/* { dg-final { scan-assembler-not "my_copysignq2:.*\\bl\t%plt\\(__builtin_copysignq\\).*my_copysignq2" } } */
-/* { dg-final { scan-assembler-not "my_infq2:.*\\bl\t%plt\\(__builtin_infq\\).*my_infq2" } } */
-/* { dg-final { scan-assembler-not "my_huge_valq2:.*\\bl\t%plt\\(__builtin_huge_valq\\).*my_huge_valq2" } } */
-/* { dg-final { scan-assembler-not "my_nanq2:.*\\bl\t%plt\\(__builtin_nanq\\).*my_nanq2" } } */
-/* { dg-final { scan-assembler-not "my_nansq2:.*\\bl\t%plt\\(__builtin_nansq\\).*my_nansq2" } } */
-
-__float128
-my_fabsq1 (__float128 a)
-{
-  return __builtin_fabsq (a);
-}
-
-_Float128
-my_fabsq2 (_Float128 a)
-{
-  return __builtin_fabsq (a);
-}
-
-__float128
-my_copysignq1 (__float128 a, __float128 b)
-{
-  return __builtin_copysignq (a, b);
-}
-
-_Float128
-my_copysignq2 (_Float128 a, _Float128 b)
-{
-  return __builtin_copysignq (a, b);
-}
-
-__float128
-my_infq1 (void)
-{
-  return __builtin_infq ();
-}
-
-_Float128
-my_infq2 (void)
-{
-  return __builtin_infq ();
-}
-
-__float128
-my_huge_valq1 (void)
-{
-  return __builtin_huge_valq ();
-}
-
-_Float128
-my_huge_valq2 (void)
-{
-  return __builtin_huge_valq ();
-}
-
-__float128
-my_nanq1 (void)
-{
-  return __builtin_nanq ("");
-}
-
-_Float128
-my_nanq2 (void)
-{
-  return __builtin_nanq ("");
-}
-
-__float128
-my_nansq1 (void)
-{
-  return __builtin_nansq ("");
-}
-
-_Float128
-my_nansq2 (void)
-{
-  return __builtin_nansq ("");
-}
-
-- 
2.43.4

